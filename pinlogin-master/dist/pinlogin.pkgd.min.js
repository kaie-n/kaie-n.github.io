/**
 * Pinlogin
 * Javascript cross-browser and flexible pincode login input experience
 *
 * Copyright (c) 2019 Bob Hageman https://github.com/bobhageman
 * License: MIT - https://opensource.org/licenses/mit-license
 *
 * https://github.com/bobhageman/pinlogin
 */

!function(t,e){"function"==typeof define&&define.amd?define("../src/pinlogin",[],e):"object"==typeof module&&module.exports?module.exports=e():t.Pinlogin=e()}(window,function(){var o="pinlogin";function i(t,e){if(this.elementId=t.id,this.defaults={fields:5,placeholder:"â€¢",autofocus:!0,hideinput:!0,reset:!0,pattern:"^[0-9]*$",copypaste:!0,complete:function(t){},invalid:function(t,e){},keydown:function(t,e,i){},input:function(t,e,i){}},this.settings=this.defaults,e)for(var i in e)this.settings[i]=e[i];var n=this._createElement("div",{id:t.id+"_"+o,class:[o]});this.values=[],this.timers=[];for(var s=0;s<this.settings.fields;s++){var a=this._createInput(this.getFieldId(s),s);this._attachEvents(a,s),n.appendChild(a)}t.appendChild(n),this.reset(),this.settings.autofocus&&this.focus(0)}return i.prototype._createElement=function(t,e){var i=document.createElement(t);for(var n in e)"class"==n?i.classList.add.apply(i.classList,e[n]):i[n]=e[n];return i},i.prototype._createInput=function(t){return this._createElement("input",{id:t,name:t,type:"tel",maxlength:1,inputmode:"numeric","x-inputmode":"numeric",pattern:this.settings.pattern,autocomplete:!1,autocorrect:"off",autocapitalize:"off",spellcheck:!1,role:"presentation",class:["pinlogin-field"]})},i.prototype._attachEvents=function(t,n){var s=this;t.addEventListener("focus",function(){this.readOnly||(this.value="")}),t.addEventListener("input",function(t){if(!s.validateInput(n))return t.preventDefault(),void t.stopPropagation();if(s.settings.input(t,this,n),s.values[n]=this.value,n<s.settings.fields-1){if(s.settings.hideinput){0<n&&(s.getField(n-1).value=s.settings.placeholder);var e=this;s.timers.push(setTimeout(function(){e.value=s.settings.placeholder},1e3))}s.getField(n+1).removeAttribute("readonly"),s.focus(n+1)}else{s.settings.hideinput&&(this.value=s.settings.placeholder);var i=s.values.join("");s.settings.reset&&s.reset(),s.settings.complete(i)}}),t.addEventListener("keydown",function(t){for(var e=0;e<s.timers.length;e++)clearTimeout(s.timers[e]);s.timers=[],s.settings.keydown(t,this,n),(37==t.keyCode||8==t.keyCode)&&0<n&&(s.resetField(n),s.focus(n-1),t.preventDefault(),t.stopPropagation())}),s.settings.copypaste&&0==n&&t.addEventListener("paste",function(t){var e;if(t.stopPropagation(),t.preventDefault(),(e=(t.clipboardData||window.clipboardData).getData("Text").trim()).length==s.settings.fields)for(var i=0;i<s.settings.fields;i++){var n=s.getField(i);if(n.removeAttribute("readonly"),n.value=e[i],!s.validateInput(i))break;s.focus(i+1)}})},i.prototype.validateInput=function(t){var e=this.getField(t),i=new RegExp(e.pattern);return e.value.match(i)?(e.classList.remove("invalid"),!0):(e.value="",e.classList.add("invalid"),this.settings.invalid(e,t),!1)},i.prototype.getFieldId=function(t){return this.elementId+"_"+o+"_"+t},i.prototype.getField=function(t){return document.getElementById(this.getFieldId(t))},i.prototype.focus=function(t){this.enableField(t),this.getField(t).focus()},i.prototype.reset=function(){this.values=new Array(this.settings.fields);for(var t=0;t<this.settings.fields;t++){var e=this.getField(t);e.value="",0<t&&(e.readOnly=!0,e.classList.remove("invalid"))}this.settings.autofocus&&this.focus(0)},i.prototype.resetField=function(t){this.values[t]="";var e=this.getField(t);e.value="",e.readOnly=!0,e.classList.remove("invalid")},i.prototype.disable=function(){for(var t=0;t<this.settings.fields;t++)this.disableField(t)},i.prototype.disableField=function(t){this.getField(t).readOnly=!0},i.prototype.enable=function(){for(var t=0;t<this.settings.fields;t++)this.enableField(t)},i.prototype.enableField=function(t){this.getField(t).removeAttribute("readonly")},"undefined"!=typeof jQuery&&($.fn[o]=function(t){var e;return this.each(function(){(e=$.data(this,o))||(e=new i(this,t),$.data(this,o,e))}),e}),i});